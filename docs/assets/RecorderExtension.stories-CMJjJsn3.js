import{c as d}from"./index-CwLM2GVF.js";import{j as r}from"./jsx-runtime-C6qLVRqm.js";import{R as ve}from"./client-Bg7Y7PbL.js";import{r as c}from"./index-C2WPW1L7.js";import"./index-CTkByED5.js";const s={id:"ext_recorder",reference_name:"RecorderExtension",supports_dark_mode:!0,description:"A screen recording extension for capturing and submitting video feedback"};var g=(o=>(o.PERMISSION_DENIED="PERMISSION_DENIED",o.DEVICE_NOT_SUPPORTED="DEVICE_NOT_SUPPORTED",o.RECORDING_FAILED="RECORDING_FAILED",o.NO_MOBILE_DEVICES="NO_MOBILE_DEVICES",o))(g||{});const Te=["video/webm","video/webm;codecs=vp8,opus","video/webm;codecs=vp9,opus","video/mp4"],he=()=>Te.find(o=>MediaRecorder.isTypeSupported(o))||"",q=()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),ge=({title:o="Screen Recording",startButtonText:y="Start Recording",stopButtonText:m="Stop Recording",submitButtonText:v="Submit",retryButtonText:T="Try Again",theme:h="light",includeAudio:w=!1,includeVideo:P=!0})=>{const[S,b]=c.useState("idle"),[M,j]=c.useState(!1),[f,V]=c.useState(""),p=c.useRef(null),R=c.useRef([]),E=c.useRef(null),U=c.useRef(null);c.useEffect(()=>{q()&&a(g.NO_MOBILE_DEVICES)},[]),c.useEffect(()=>()=>{f&&URL.revokeObjectURL(f)},[f]);const L=e=>{var n,t;(t=(n=window.voiceflow)==null?void 0:n.chat)==null||t.interact(e)},a=e=>{const n={id:typeof e=="string"?g.RECORDING_FAILED:e,details:typeof e=="string"?e:void 0};L({type:"error",payload:n})},ye=async()=>{try{if(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia){a(g.DEVICE_NOT_SUPPORTED);return}let e;if(P)e=await navigator.mediaDevices.getDisplayMedia({video:!0,audio:!1});else if(!P&&w)try{e=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1})}catch{a("Failed to access microphone");return}else{a("Either video or audio must be enabled");return}if(P&&w&&navigator.mediaDevices.getUserMedia)try{const t=await navigator.mediaDevices.getUserMedia({audio:!0,video:!1}),x=[...e.getTracks(),...t.getTracks()];e=new MediaStream(x)}catch(t){console.warn("Could not get audio stream:",t)}const n=he();if(!n)throw new Error("No supported MIME type found");U.current=e,p.current=new MediaRecorder(e,{mimeType:n}),R.current=[],p.current.ondataavailable=t=>{t.data.size>0&&R.current.push(t.data)},p.current.onerror=()=>{a("MediaRecorder failed during recording")},p.current.onstop=()=>{var t;try{(t=U.current)==null||t.getTracks().forEach(Ee=>Ee.stop());const x=new Blob(R.current,{type:n});f&&URL.revokeObjectURL(f);const F=URL.createObjectURL(x);V(F),E.current&&(E.current.src=F),b("preview")}catch(x){a(x instanceof Error?x.message:"Failed to process recording")}},p.current.start(100),b("recording")}catch(e){console.error("Recording error:",e),e instanceof Error?e.name==="NotAllowedError"?a(g.PERMISSION_DENIED):e.message==="No supported MIME type found"?a(g.DEVICE_NOT_SUPPORTED):a(e.message):a(g.RECORDING_FAILED),b("idle")}},Se=()=>{if(p.current&&S==="recording")try{p.current.stop()}catch(e){a(e instanceof Error?e.message:"Failed to stop recording"),b("idle")}},be=()=>{var e;try{const n=((e=p.current)==null?void 0:e.mimeType)||"video/webm",t=new Blob(R.current,{type:n});L({type:"complete",payload:{mimeType:n,recordingData:t}}),j(!0)}catch(n){a(n instanceof Error?n.message:"Failed to submit recording")}},Re=()=>{f&&(URL.revokeObjectURL(f),V("")),R.current=[],E.current&&(E.current.src=""),b("idle"),j(!1)};return r.jsx("div",{className:`recorder-ext-wrapper ${h}`,children:r.jsxs("div",{className:"recorder-ext-container",children:[o&&r.jsx("h2",{className:"recorder-ext-title",children:o}),q()?r.jsx("div",{className:"recorder-ext-mobile-message",children:r.jsx("p",{children:"Screen recording is not supported on mobile devices. Please use a desktop browser."})}):r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"recorder-ext-video-container",children:r.jsx("video",{ref:E,className:"recorder-ext-preview",controls:!0,style:{display:S==="preview"?"block":"none"},playsInline:!0})}),r.jsxs("div",{className:"recorder-ext-controls",children:[S==="idle"&&r.jsx("button",{className:"recorder-ext-button recorder-ext-start",onClick:ye,children:y}),S==="recording"&&r.jsx("button",{className:"recorder-ext-button recorder-ext-stop",onClick:Se,children:m}),S==="preview"&&r.jsxs("div",{className:"recorder-ext-button-group",children:[r.jsx("button",{className:`recorder-ext-button recorder-ext-submit ${M?"submitted":""}`,onClick:be,disabled:M,children:v}),r.jsx("button",{className:"recorder-ext-button recorder-ext-retry",onClick:Re,children:T})]})]})]})]})})};ge.__docgenInfo={description:"",methods:[],displayName:"RecorderComponent",props:{title:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:'"Screen Recording"',computed:!1}},startButtonText:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:'"Start Recording"',computed:!1}},stopButtonText:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:'"Stop Recording"',computed:!1}},submitButtonText:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:'"Submit"',computed:!1}},retryButtonText:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:'"Try Again"',computed:!1}},theme:{required:!1,tsType:{name:"union",raw:'"light" | "dark"',elements:[{name:"literal",value:'"light"'},{name:"literal",value:'"dark"'}]},description:"",defaultValue:{value:'"light"',computed:!1}},includeAudio:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},includeVideo:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"true",computed:!1}}}};const we=".recorder-ext-wrapper{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen,Ubuntu,Cantarell,Open Sans,Helvetica Neue,sans-serif;max-width:100%;margin:0 auto;padding:1rem}.recorder-ext-container{background:var(--vf-bg-color, #ffffff);border-radius:12px;padding:1.5rem;box-shadow:0 2px 8px #0000001a}.recorder-ext-title{color:var(--vf-text-color, #333333);font-size:1.5rem;margin:0 0 1rem;text-align:center}.recorder-ext-video-container{width:100%;margin:1rem 0;border-radius:8px;overflow:hidden;background:#0000000d;min-height:200px}.recorder-ext-preview{width:100%;max-height:400px;object-fit:contain}.recorder-ext-controls{display:flex;justify-content:center;gap:.75rem;margin-top:1rem;flex-wrap:wrap}.recorder-ext-button{padding:.75rem 1.25rem;border-radius:6px;border:none;font-size:.875rem;line-height:1.2;font-weight:500;cursor:pointer;transition:all .2s ease;text-align:center;white-space:normal;min-width:80px;max-width:150px}.recorder-ext-start{background:var(--vf-primary-color, #007aff);color:#fff}.recorder-ext-stop{background:var(--vf-danger-color, #ff3b30);color:#fff}.recorder-ext-submit{background:var(--vf-success-color, #34c759);color:#fff}.recorder-ext-submit.submitted,.recorder-ext-submit.submitted:hover{background:var(--vf-secondary-color, #8e8e93);opacity:.7;transform:none;cursor:not-allowed;pointer-events:none}.recorder-ext-retry{background:var(--vf-secondary-color, #8e8e93);color:#fff}.recorder-ext-button:hover{opacity:.9;transform:translateY(-1px)}.recorder-ext-button:active{transform:translateY(0)}.recorder-ext-button:disabled{cursor:not-allowed;opacity:.7}.recorder-ext-button-group{display:flex;gap:.75rem;flex-wrap:wrap;justify-content:center}.dark{--vf-bg-color: #1c1c1e;--vf-text-color: #ffffff;--vf-primary-color: #0a84ff;--vf-danger-color: #ff453a;--vf-success-color: #32d74b;--vf-secondary-color: #98989d}",u={name:s.reference_name,type:"response",match:({trace:o})=>{var y;return o.type===s.id||((y=o.payload)==null?void 0:y.name)===s.id},render:({element:o,trace:y})=>{const m=o.attachShadow({mode:"open"}),v=document.createElement("div"),T=document.createElement("style");T.textContent=we,m.appendChild(T),m.appendChild(v);const h=ve.createRoot(v),w=y.payload;return h.render(r.jsx(ge,{...w})),()=>{requestAnimationFrame(()=>{for(h.unmount();m.firstChild;)m.removeChild(m.firstChild)})}}},Ne={title:"Extensions/Recorder",parameters:{layout:"centered"}},i={containerStyles:{width:"320px"}},l={default:{title:"Record Your Screen"},customButtons:{title:"Share Your Experience",startButtonText:"Begin Screen Recording",stopButtonText:"End Recording",submitButtonText:"Share Recording with Support Team",retryButtonText:"Record Again"},darkTheme:{title:"Record Bug Report",startButtonText:"Start Recording",stopButtonText:"Stop",submitButtonText:"Submit Bug Report",retryButtonText:"Try Again",theme:"dark"},noTitle:{startButtonText:"Record",stopButtonText:"Stop",submitButtonText:"Send",retryButtonText:"Retry"},longText:{title:"Record a Video of Your Issue",startButtonText:"Start Recording Your Screen and Audio",stopButtonText:"Stop Recording Now",submitButtonText:"Submit Your Recording for Analysis by Our Support Team",retryButtonText:"Record a New Video"},withAudio:{title:"Record Screen & Audio",startButtonText:"Start Recording",stopButtonText:"Stop Recording",submitButtonText:"Submit Recording",retryButtonText:"Record Again",includeAudio:!0},videoOnly:{title:"Silent Screen Recording",startButtonText:"Start Screen Capture",stopButtonText:"Stop Capture",submitButtonText:"Submit Recording",retryButtonText:"Record Again",includeAudio:!1},fullConfig:{title:"Full Configuration Demo",startButtonText:"Start Recording",stopButtonText:"Stop Recording",submitButtonText:"Submit",retryButtonText:"Try Again",theme:"dark",includeAudio:!0,includeVideo:!0},audioOnly:{title:"Voice Recording Only",startButtonText:"Start Voice Recording",stopButtonText:"Stop Recording",submitButtonText:"Submit Voice Note",retryButtonText:"Record Again",includeAudio:!0,includeVideo:!1}},B=d(u,s,l.default,i),O=d(u,s,l.customButtons,i),k=d(u,s,l.darkTheme,{...i,containerStyles:{...i.containerStyles,background:"#000000",padding:"1rem"}}),D=d(u,s,l.noTitle,i),_=d(u,s,l.longText,i),N=d(u,s,l.withAudio,i),C=d(u,s,l.videoOnly,i),I=d(u,s,l.fullConfig,{...i,containerStyles:{...i.containerStyles,background:"#000000",padding:"1rem"}}),A=d(u,s,l.audioOnly,{...i,containerStyles:{...i.containerStyles,background:"#f5f5f5",padding:"1rem"}});var Y,G,z;B.parameters={...B.parameters,docs:{...(Y=B.parameters)==null?void 0:Y.docs,source:{originalSource:"createExtensionStory<ExtensionPayload>(RecorderExtension, extension_config, recorders.default, options)",...(z=(G=B.parameters)==null?void 0:G.docs)==null?void 0:z.source}}};var W,$,H;O.parameters={...O.parameters,docs:{...(W=O.parameters)==null?void 0:W.docs,source:{originalSource:"createExtensionStory<ExtensionPayload>(RecorderExtension, extension_config, recorders.customButtons, options)",...(H=($=O.parameters)==null?void 0:$.docs)==null?void 0:H.source}}};var J,K,Q;k.parameters={...k.parameters,docs:{...(J=k.parameters)==null?void 0:J.docs,source:{originalSource:`createExtensionStory<ExtensionPayload>(RecorderExtension, extension_config, recorders.darkTheme, {
  ...options,
  containerStyles: {
    ...options.containerStyles,
    background: "#000000",
    padding: "1rem"
  }
})`,...(Q=(K=k.parameters)==null?void 0:K.docs)==null?void 0:Q.source}}};var X,Z,ee;D.parameters={...D.parameters,docs:{...(X=D.parameters)==null?void 0:X.docs,source:{originalSource:"createExtensionStory<ExtensionPayload>(RecorderExtension, extension_config, recorders.noTitle, options)",...(ee=(Z=D.parameters)==null?void 0:Z.docs)==null?void 0:ee.source}}};var te,re,oe;_.parameters={..._.parameters,docs:{...(te=_.parameters)==null?void 0:te.docs,source:{originalSource:"createExtensionStory<ExtensionPayload>(RecorderExtension, extension_config, recorders.longText, options)",...(oe=(re=_.parameters)==null?void 0:re.docs)==null?void 0:oe.source}}};var ne,ae,se;N.parameters={...N.parameters,docs:{...(ne=N.parameters)==null?void 0:ne.docs,source:{originalSource:"createExtensionStory<ExtensionPayload>(RecorderExtension, extension_config, recorders.withAudio, options)",...(se=(ae=N.parameters)==null?void 0:ae.docs)==null?void 0:se.source}}};var ie,ce,de;C.parameters={...C.parameters,docs:{...(ie=C.parameters)==null?void 0:ie.docs,source:{originalSource:"createExtensionStory<ExtensionPayload>(RecorderExtension, extension_config, recorders.videoOnly, options)",...(de=(ce=C.parameters)==null?void 0:ce.docs)==null?void 0:de.source}}};var ue,le,pe;I.parameters={...I.parameters,docs:{...(ue=I.parameters)==null?void 0:ue.docs,source:{originalSource:`createExtensionStory<ExtensionPayload>(RecorderExtension, extension_config, recorders.fullConfig, {
  ...options,
  containerStyles: {
    ...options.containerStyles,
    background: "#000000",
    padding: "1rem"
  }
})`,...(pe=(le=I.parameters)==null?void 0:le.docs)==null?void 0:pe.source}}};var me,fe,xe;A.parameters={...A.parameters,docs:{...(me=A.parameters)==null?void 0:me.docs,source:{originalSource:`createExtensionStory<ExtensionPayload>(RecorderExtension, extension_config, recorders.audioOnly, {
  ...options,
  containerStyles: {
    ...options.containerStyles,
    background: "#f5f5f5",
    padding: "1rem"
  }
})`,...(xe=(fe=A.parameters)==null?void 0:fe.docs)==null?void 0:xe.source}}};const Ce=["Default","CustomButtonText","DarkTheme","NoTitle","LongButtonText","WithAudio","VideoOnly","FullConfiguration","AudioOnly"];export{A as AudioOnly,O as CustomButtonText,k as DarkTheme,B as Default,I as FullConfiguration,_ as LongButtonText,D as NoTitle,C as VideoOnly,N as WithAudio,Ce as __namedExportsOrder,Ne as default};
